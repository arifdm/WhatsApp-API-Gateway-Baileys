<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WhatsApp Connection Status</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
      }
      #qr-container {
        margin: 20px 0;
        text-align: center;
      }
      #qr-image {
        max-width: 300px;
        border: 1px solid #ddd;
        padding: 10px;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }
      .connecting {
        background-color: #fff3cd;
        color: #856404;
      }
      .connected {
        background-color: #d4edda;
        color: #155724;
      }
      .disconnected {
        background-color: #f8d7da;
        color: #721c24;
      }
      .not-found {
        background-color: #f8f9fa;
        color: #6c757d;
      }
      button {
        padding: 8px 16px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #0069d9;
      }
    </style>
  </head>
  <body>
    <h1>WhatsApp Connection Status</h1>

    <div>
      <input type="text" id="sessionId" placeholder="Enter session ID" />
      <button id="createSession">Create Session</button>
    </div>

    <div id="qr-container" style="display: none">
      <h3>Scan QR Code</h3>
      <img id="qr-image" src="" alt="QR Code" />
    </div>

    <div id="status" class="status not-found">Status: Not connected</div>

    <script>
      const socket = io();
      let currentSessionId = null;

      // DOM elements
      const sessionIdInput = document.getElementById("sessionId");
      const createSessionBtn = document.getElementById("createSession");
      const qrContainer = document.getElementById("qr-container");
      const qrImage = document.getElementById("qr-image");
      const statusDiv = document.getElementById("status");

      // Handle create session button click
      createSessionBtn.addEventListener("click", () => {
        const sessionId = sessionIdInput.value.trim();
        if (!sessionId) {
          alert("Please enter a session ID");
          return;
        }

        currentSessionId = sessionId;
        socket.emit("create-session", sessionId);
      });

      // Socket.IO event listeners
      socket.on("qr-update", (qrData) => {
        qrContainer.style.display = "block";
        qrImage.src = qrData;
      });

      socket.on("status-update", (status) => {
        statusDiv.className = `status ${status}`;
        statusDiv.textContent = `Status: ${status}`;

        if (status === "connected") {
          qrContainer.style.display = "none";
        }
      });

      socket.on("session-created", (sessionId) => {
        console.log(`Session created: ${sessionId}`);
        // Periodically check status
        setInterval(() => {
          socket.emit("get-status", sessionId);
        }, 1000);
      });

      socket.on("session-error", (error) => {
        alert(`Error: ${error}`);
      });
    </script>
  </body>
</html>
